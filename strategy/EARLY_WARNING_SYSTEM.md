# 多维度早期预警系统

## 🚨 系统概述

新的早期预警系统采用多维度检测机制，能够更精准地识别老年人的情绪风险，并提供分级响应策略。

## 📊 检测维度

### **1. 急性高风险检测**
- **触发条件**: `current_sadness > 0.9`
- **响应级别**: `severe`
- **建议行动**: 立即关注，建议人工介入
- **适用场景**: 用户表达极度悲伤或自伤倾向

### **2. 持续性检测**
- **连续高sadness**: 连续2-3次 `sadness > 0.8`
- **响应级别**: `moderate` (2次) / `severe` (3次)
- **建议行动**: 需要持续关注，建议增加关怀频率

### **3. 趋势恶化检测**
- **触发条件**: 近期平均 - 历史平均 > 0.3 且 近期平均 > 0.6
- **响应级别**: `moderate`
- **建议行动**: 情绪趋势恶化，建议主动关怀
- **数据要求**: 至少6个历史数据点

### **4. 长期趋势检测**
- **触发条件**: 最近10次对话平均 `sadness > 0.7`
- **响应级别**: `mild`
- **建议行动**: 长期情绪偏低，建议定期关怀

### **5. 多维度综合检测**
- **触发条件**: 
  - `current_sadness > 0.6`
  - `self_focus_freq > 0.15` (高自我关注，15%以上)
  - `social_freq < 0.05` (低社交，5%以下)
  - `sadness_LIWC_freq > 0.08` (负面情绪，8%以上)
- **响应级别**: `moderate`
- **建议行动**: 社交退缩倾向，建议鼓励社交活动

## 🎯 响应策略

### **Severe级别** (严重)
```python
{
    "语气": "紧急关切",
    "目标": "立即情绪干预，建议转介专业支持",
    "引导语": "我注意到{reason}，这让我非常担心你的状态。你愿意和我详细聊聊吗？如果需要的话，我建议我们可以联系专业的心理支持资源。",
    "心理学依据": "急性情绪危机需要立即关注和专业干预。"
}
```

### **Moderate级别** (中等)
```python
{
    "语气": "关切引导",
    "目标": "主动关怀，预防情绪恶化",
    "引导语": "我注意到{reason}，你最近是不是遇到了一些困难？愿意和我聊聊吗？我会一直陪着你。",
    "心理学依据": "早期干预可以有效预防情绪问题恶化。"
}
```

### **Mild级别** (轻微)
```python
{
    "语气": "温和关怀",
    "目标": "增加关怀频率，预防问题发展",
    "引导语": "我注意到{reason}，你最近心情怎么样？有什么想和我分享的吗？",
    "心理学依据": "定期关怀有助于维持情绪稳定。"
}
```

## 🔧 技术实现

### **数据结构**
```python
warning_result = {
    "triggered": bool,           # 是否触发预警
    "level": str,               # 预警级别: normal/mild/moderate/severe
    "reason": str,              # 触发原因
    "suggested_action": str     # 建议行动
}
```

### **调用方式**
```python
# 在select_strategy中调用
early_warning_result = selector.check_early_warning(
    window_sadness_scores=window_sadness_scores,
    current_sadness=sadness,
    liwc_scores=liwc_mapped
)

# 根据预警结果选择策略
if early_warning_result["triggered"]:
    warning_level = early_warning_result["level"]
    # 选择对应级别的响应策略
```

## 📈 优势特点

### **1. 多维度检测**
- 不仅看单一指标，而是综合考虑多个维度
- 减少误报和漏报

### **2. 分级响应**
- 根据风险级别提供不同的响应策略
- 避免过度反应或反应不足

### **3. 趋势分析**
- 不仅看当前状态，还分析历史趋势
- 能够提前发现潜在问题

### **4. 个性化建议**
- 根据具体触发原因提供针对性建议
- 提高干预效果

### **5. 可扩展性**
- 易于添加新的检测维度
- 可以根据实际使用情况调整阈值

## 🎛️ 参数调优

### **可调整的阈值**
```python
# 急性风险阈值
ACUTE_RISK_THRESHOLD = 0.9

# 连续高sadness阈值
HIGH_SADNESS_THRESHOLD = 0.8
HIGH_SADNESS_COUNT = 2

# 趋势恶化阈值
TREND_DETERIORATION_THRESHOLD = 0.3
RECENT_AVG_THRESHOLD = 0.6

# 长期趋势阈值
LONG_TERM_THRESHOLD = 0.7
LONG_TERM_COUNT = 10

# LIWC特征阈值 (百分比形式，0-1)
SELF_FOCUS_THRESHOLD = 0.15  # 15%以上自我关注
SOCIAL_THRESHOLD = 0.05      # 5%以下社交词汇
SADNESS_LIWC_THRESHOLD = 0.08  # 8%以上负面情绪词汇
```

## 🔄 使用流程

1. **数据收集**: 收集情绪分数、LIWC特征、对话历史
2. **多维度检测**: 并行执行各种检测算法
3. **优先级排序**: 按严重程度选择最高级别的预警
4. **策略选择**: 根据预警级别选择相应的响应策略
5. **执行干预**: 生成相应的引导语和建议

## 📝 注意事项

1. **隐私保护**: 预警信息应妥善处理，避免泄露
2. **人工介入**: 严重预警应及时转介人工服务
3. **持续监控**: 预警后应持续关注用户状态
4. **阈值调整**: 根据实际使用效果调整检测阈值
5. **用户反馈**: 收集用户对预警准确性的反馈 